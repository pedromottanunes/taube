<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerar Orçamento • OD Drive</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --od-primary: #0f766e;
      --od-primary-light: #14b8a6;
      --od-secondary: #0891b2;
    }
    
    .bg-gradient-primary {
      background: linear-gradient(135deg, var(--od-primary) 0%, var(--od-primary-light) 100%);
    }
    
    .bg-gradient-secondary {
      background: linear-gradient(135deg, var(--od-secondary) 0%, var(--od-primary-light) 100%);
    }
    
    .border-gradient {
      border: 2px solid transparent;
      background: linear-gradient(white, white) padding-box,
                  linear-gradient(135deg, var(--od-primary), var(--od-primary-light)) border-box;
    }
    
    .input-focus {
      transition: all 0.3s ease;
    }
    
    .input-focus:focus {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(15, 118, 110, 0.15);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--od-primary) 0%, var(--od-primary-light) 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(15, 118, 110, 0.3);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .card-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .floating-label {
      transition: all 0.3s ease;
    }
    
    .input-group:focus-within .floating-label {
      transform: translateY(-8px) scale(0.85);
      color: var(--od-primary);
    }
    
    .input-group input:not(:placeholder-shown) + .floating-label {
      transform: translateY(-8px) scale(0.85);
      color: var(--od-primary);
    }
    
    .upload-area {
      transition: all 0.3s ease;
      border: 2px dashed #d1d5db;
    }
    
    .upload-area:hover {
      border-color: var(--od-primary);
      background-color: rgba(15, 118, 110, 0.05);
    }
    
    .upload-area.dragover {
      border-color: var(--od-primary-light);
      background-color: rgba(20, 184, 166, 0.1);
      transform: scale(1.02);
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-fade-in-up {
      animation: fadeInUp 0.6s ease-out;
    }
    
    .animate-delay-100 { animation-delay: 0.1s; }
    .animate-delay-200 { animation-delay: 0.2s; }
    .animate-delay-300 { animation-delay: 0.3s; }
    
    .icon-field {
      position: relative;
    }
    
    .icon-field .icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
      transition: color 0.3s ease;
    }
    
    .icon-field input:focus + .icon {
      color: var(--od-primary);
    }
    
    .icon-field input {
      padding-left: 40px;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 px-4 py-8">
  <!-- Background Pattern -->
  <div class="fixed inset-0 opacity-5">
    <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25% 25%, var(--od-primary) 2px, transparent 2px); background-size: 50px 50px;"></div>
  </div>

  <!-- Main Container -->
  <div class="relative max-w-2xl mx-auto">
    <!-- Header Section -->
    <div class="text-center mb-8 animate-fade-in-up">

      
      
    <h1 class="flex items-center justify-center text-4xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent mb-2 gap-3">
  <!-- Ícone do Dropbox (exemplo): -->
  <img src="https://www.dropbox.com/scl/fi/1lcom3fqzeltyx32h1jya/logood.png?rlkey=1pk6lohumczfbgpk4033vglhu&st=xuv4ltyc&dl=1" alt="Ícone" class="w-18 h-12 mr-2">
 
</h1>

      

      <div class="w-24 h-1 bg-gradient-primary rounded-full mx-auto mt-4"></div>
    </div>

    <!-- Form Container -->
    <div class="card-container rounded-3xl shadow-2xl p-8 animate-fade-in-up animate-delay-100">
      <form id="odForm" class="space-y-8">
        
        <!-- Company Information Section -->
        <div class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
            <i data-lucide="building-2" class="w-5 h-5 text-teal-600"></i>
            Informações da Empresa
          </h2>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Company Name -->
            <div class="lg:col-span-2 icon-field">
              <input 
                id="company_name" 
                name="company_name" 
                required
                placeholder="Nome da empresa"
                class="w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 focus:ring-0 text-gray-800 font-medium"
              >
              <i data-lucide="building" class="icon w-5 h-5"></i>
            </div>

            <!-- Website -->
            <div class="icon-field">
              <input 
                id="site_url" 
                name="site_url" 
                type="url" 
                required
                placeholder="https://exemplo.com"
                class="w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 focus:ring-0 text-gray-800"
              >
              <i data-lucide="globe" class="icon w-5 h-5"></i>
            </div>

            <!-- City -->
            <div class="icon-field">
              <input 
                id="city" 
                name="city" 
                required
                placeholder="Cidade"
                class="w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 focus:ring-0 text-gray-800"
              >
              <i data-lucide="map-pin" class="icon w-5 h-5"></i>
            </div>

           Seleção de Produtos
            </h3>
          <div id="product_wrapper" class="space-y-4">
            <div class="flex items-center gap-2 product-item">
              <select id="product_1" name="product[]" required class="w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 text-gray-800">
                <option value="" disabled selected>Selecione um produto</option>
                <option value="OD_VT">02 · OD VT</option>
                <option value="OD_DROP">03 · OD DROP</option>
                <option value="OD_PACK">04 · OD PACK</option>
                <option value="OD_FULL">05 · OD FULL</option>
                <option value="OD_LIGHT">06 · OD LIGHT</option>
              </select>
              <!-- Botão de remover só aparece a partir do segundo -->
            </div>
          </div>

          <button type="button" id="addProduct" class="flex items-center gap-2 text-teal-700 font-medium hover:text-teal-900 transition"><i data-lucide="plus-circle" class="w-5 h-5"></i>Adicionar outro produto</button>
        </div>
        <!-- Project Details Section -->
        <div class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
            <i data-lucide="settings" class="w-5 h-5 text-teal-600"></i>
            Detalhes do Projeto
          </h2>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <!-- Cars Quantity -->
            <div class="icon-field">
              <input 
                id="cars_qtd" 
                name="cars_qtd" 
                type="number" 
                min="1" 
                required
                placeholder="Quantidade de carros"
                class="w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 focus:ring-0 text-gray-800"
              >
              <i data-lucide="car" class="icon w-5 h-5"></i>
            </div>

            <!-- Discount -->
            <div class="icon-field">
              <input 
                id="discount" 
                name="discount" 
                type="number" 
                step="0.01" 
                value="0"
                placeholder="Desconto (R$)"
                class="w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 focus:ring-0 text-gray-800"
              >
              <i data-lucide="percent" class="icon w-5 h-5"></i>
            </div>
          </div>
        </div>


          <!-- Dias de campanha -->
<div class="icon-field">
  <input 
    id="campaign_days"
    name="campaign_days"
    type="number"
    min="1"
    required
    placeholder="Dias de campanha"
    class="w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 focus:ring-0 text-gray-800"
  >
  <i data-lucide="calendar-days" class="icon w-5 h-5"></i>
</div>


                 

        <!-- File Upload Section -->
        <div class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
            <i data-lucide="upload" class="w-5 h-5 text-teal-600"></i>
            Imagem de referência
          </h2>
          
          <div class="upload-area rounded-xl p-2 text-center cursor-pointer" id="uploadArea">
            <input 
              id="mockup_image" 
              name="mockup_image" 
              type="file"
              accept="image/png,image/jpeg" 
              required
              class="hidden"
            >
            <div class="upload-content">
              <div class="inline-flex items-center justify-center w-6 h-6 bg-gray-100 rounded-full mb-4">
                <i data-lucide="image" class="w-4 h-4 text-gray-400"></i>
              </div>
              <p class="text-lg font-medium text-gray-700 mb-2">Clique para enviar ou arraste aqui</p>
              <p class="text-sm text-gray-500">PNG ou JPG até 10MB</p>
            </div>
            <div class="file-preview hidden">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4">
                <i data-lucide="check" class="w-8 h-8 text-green-600"></i>
              </div>
              <p class="text-lg font-medium text-green-700 mb-2">Arquivo selecionado</p>
              <p class="text-sm text-gray-600 file-name"></p>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button 
          type="submit"
          class="w-full h-16 btn-primary text-white font-bold text-lg rounded-xl shadow-lg flex items-center justify-center gap-3"
        >
          <i data-lucide="send" class="w-6 h-6"></i>
          Gerar Orçamento
        </button>

        <!-- Status Message -->
        <div id="msg" class="text-center text-sm mt-4 hidden"></div>
      </form>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-gray-500 text-sm animate-fade-in-up animate-delay-300">
      <p>© 2024 OD Drive. Todos os direitos reservados.</p>
    </div>
  </div>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // Configuration
    const WEBHOOK_URL = 'https://hook.us2.make.com/7oibqbjdcjbhjrayxruwc0a73f73if8i';

    // DOM References
    const form = document.getElementById('odForm');
    const msg = document.getElementById('msg');
    const inputFile = document.getElementById('mockup_image');
    const uploadArea = document.getElementById('uploadArea');
    const uploadContent = uploadArea.querySelector('.upload-content');
    const filePreview = uploadArea.querySelector('.file-preview');
    const fileName = uploadArea.querySelector('.file-name');


/* Produtos dinâmicos */
const productWrapper = document.getElementById('product_wrapper');
const addProductBtn  = document.getElementById('addProduct');
let productCount = 1;

function createProductSelect(id, showRemove = true) {
  const wrapper = document.createElement('div');
  wrapper.className = "flex items-center gap-2 product-item";

  // select
// select do produto
const select = document.createElement('select');
select.id = 'product_' + id;
select.name = 'product[]';
select.required = true;
select.className = 'w-full h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 text-gray-800';
select.innerHTML = `
  <option value="" disabled selected>Selecione um produto</option>
  <option value="OD_VT">1 - OD VT</option>
  <option value="OD_DROP">2 - OD DROP</option>
  <option value="OD_PACK">3 - OD PACK</option>
  <option value="OD_FULL">4 - OD FULL</option>
  <option value="OD_LIGHT">5 - OD LIGHT</option>
`;

// campo de preço unitário
const inputPrice = document.createElement('input');
inputPrice.type = 'number';
inputPrice.step = '0.01';
inputPrice.min = '0';
inputPrice.placeholder = 'Preço unitário';
inputPrice.required = true;
inputPrice.className = 'w-36 h-14 rounded-xl border-2 border-gray-200 input-focus focus:border-teal-500 focus:ring-0 text-gray-800 px-3';

// Nome dinâmico para fácil captura no envio
inputPrice.name = 'unit_price[]';

wrapper.appendChild(select);
wrapper.appendChild(inputPrice);


  // botão remover (apenas se showRemove for true)
  if (showRemove) {
    const removeBtn = document.createElement('button');
    removeBtn.type = "button";
    removeBtn.innerHTML = '<i data-lucide="x-circle" class="w-5 h-5 text-red-500"></i>';
    removeBtn.className = "ml-2 p-1";
    removeBtn.onclick = () => {
      wrapper.remove();
    };
    wrapper.appendChild(removeBtn);
  }

  return wrapper;
}

// Inicial (primeiro produto, sem botão remover)
productWrapper.innerHTML = '';
productWrapper.appendChild(createProductSelect(1, false));
productCount = 1;

// Botão adicionar produto
addProductBtn.onclick = () => {
  productCount++;
  productWrapper.appendChild(createProductSelect(productCount, true));
  lucide.createIcons();
};






    

    // Utility function for messages
    function showMsg(text, ok = true) {
      msg.textContent = text;
      msg.className = `text-center text-sm mt-4 ${ok ? 'text-teal-600' : 'text-red-600'}`;
      msg.classList.remove('hidden');
    }

    // File upload handling
    uploadArea.addEventListener('click', () => inputFile.click());

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        inputFile.files = files;
        updateFilePreview(files[0]);
      }
    });

    inputFile.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        updateFilePreview(e.target.files[0]);
      }
    });

    function updateFilePreview(file) {
      if (file && ['image/png', 'image/jpeg'].includes(file.type)) {
        uploadContent.classList.add('hidden');
        filePreview.classList.remove('hidden');
        fileName.textContent = file.name;
      }
    }

    // Form submission
    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      msg.classList.add('hidden');

      // Validate image
      const file = inputFile.files[0];
      if (!file || !['image/png', 'image/jpeg'].includes(file.type)) {
        showMsg('❌ Selecione uma imagem PNG ou JPG', false);
        return;
      }

      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i> Enviando...';
      submitBtn.disabled = true;
      lucide.createIcons();

      try {
            const fd = new FormData();
            fd.set('company_name', form.company_name.value);
            fd.set('site_url', form.site_url.value);
            fd.set('city', form.city.value);
            fd.set('cars_qtd', form.cars_qtd.value);
            fd.set('discount', form.discount.value);
            fd.set('campaign_days', form.campaign_days?.value || '');
            fd.set('mockup_image', file);
            
            // Coletar todos os produtos e seus preços unitários:
            const productSelects = productWrapper.querySelectorAll('select[name="product[]"]');
            const priceInputs = productWrapper.querySelectorAll('input[name="unit_price[]"]');
            const productsArr = [];
            
            productSelects.forEach((select, idx) => {
              const produto = select.value;
              const preco = priceInputs[idx].value;
              if (produto && preco) {
                productsArr.push({ produto, preco });
              }
            });
            
            // Enviar como JSON string (no Make você acessa como texto e depois separa, ou pode separar no Make usando Parse JSON)
            fd.set('products', JSON.stringify(productsArr));
            
            const res = await fetch(WEBHOOK_URL, { method: 'POST', body: fd });





        
        if (!res.ok) throw new Error('Webhook ' + res.status);
      
        
        showMsg('✅ Orçamento enviado com sucesso!');
        form.reset();
        uploadContent.classList.remove('hidden');
        filePreview.classList.add('hidden');
      } catch (err) {
        console.error(err);
        showMsg('Erro ao enviar: ' + (err.message || err), false);
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        lucide.createIcons();
      }
    });

    // Input animations
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('focus', () => {
        input.parentElement.classList.add('focused');
      });
      
      input.addEventListener('blur', () => {
        input.parentElement.classList.remove('focused');
      });
    });
  </script>
</body>
</html>

